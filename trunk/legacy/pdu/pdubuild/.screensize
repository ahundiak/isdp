
function screensize {
	case $TERM in
	vt*) ;;
	*)
		LINES=24
		COLUMNS=80
		return
		;;
	esac

	OIFS=$IFS
	trap "" 2
	STTY=$(stty -g)
	stty -isig -icanon -echo eol '^@' eof '^@'
	echo "\033\c"
	echo "7\033[100;200H\033[6n\0338\c"
	b=""
	while :
	do
		read b2
		b="${b}${b2}"
		case "$b2" in
		*R*) break ;;
		esac
	done
	IFS="[;R"
	set -- $b
	LINES=$2
	COLUMNS=$3
	IFS=$OIFS
	stty $STTY
	unset OIFS b b2 e
	echo "Screensize: $LINES x $COLUMNS"
	trap 2
}

if [ "$ENVIRONMENT" != "BATCH" ]
then
	screensize
	export LINES COLUMNS
	tput init
fi

