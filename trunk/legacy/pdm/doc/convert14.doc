
I/PDM - I/PDU 2.1.x Converter Guide

The 2.1.x version of I/PDM - I/PDU contains many features that
were not found in the 1.4.x and 1.4.x versions.  Before you can
use the features of 2.1.x, you must convert the 1.4.x. and 1.4.x
databases to the 2.1.x format.  You can do this by running the
converter that is delivered with the 2.1.x software.  This
document contains the information needed to convert both a
 
1.4.x database to the 2.1.x format.

:I/PDM - I/PDU Conversion Process 1.4.x to 2.1.x:

The following information explains the process for converting
a 1.4.x database to a 2.1.x.

Administrative User Account

The 2.1.x version of I/PDM requires an administrative user
account called nfmadmin.  This account is used to initialize
I/NFM and I/PDM and must be passworded.

The following steps explain how to add the this user and set
up the

1.   Log onto the the node which will be designated as the
     I/PDM server.

2.   Create a user account called nfmadmin on this node.

     Note:

     This account must have a password.

3.   If your RDBMS is INFORMIX, In the .profile file of the
     nfmadmin account, add the following information, where
     /usrx is the partition that applies for each entry:

     INFORMIXDIR=/usrx/informix
     SQLEXEC=/usrx/informix/lib/sqlexec if using Standard Engine INFORMIX

     OR

     SQLEXEC=/usrx/informix/lib/sqlturbo if using on-line INFORMIX

     export INFORMIXDIR SQLEXEC 
     If your database will reside in a directory other than
     /usr/nfmadmin, you must also include the following line in
     your .profile, and export that entry.

     DBPATH=/usrx/<I/NFM database administrator name>

     export INFORMIXDIR SQLEXEC DBPATH 

I/PDM Server Software Requirements and Installation

The following is the software requirements and the order in
which the software needs to be loaded.

 Nucleus software 6.0 or newer

 Relational Database (INFORMIX OnLine or INFORMIX SE, ORACLE, INGRESS, DB2)

 Network protocol (XNS or TCPIP) Reboot system prior to
     loading the RIS software.

 INFORMIX Dataserver RIS Server (RISXC - 3.2.2.x)

 RIS Client (RISCCU - 3.2.x)

 I/NFM (3.2.x)

 I/PDM (2.1.x)

RIS Server Node

The examples provided below will help you to record
information about each node that you want to use for I/NFM -
I/PDM and to determine the software that will be installed on
each node.

               The RIS Server Node

               Nodename        __________________
               Username        __________________
               Password        __________________
               Pathname        __________________
               Software        __________________ 

I/PDU Client Node

Fill in the information in the blanks below for the I/PDU client
nodes.  You will probably designate more than one or two
machines as I/PDU client nodes.  If so, make a list of all
machines that will need access the I/NFM-I/PDM server, and
record them below.  All I/PDU client nodes are required to have
the NFMfileserver and the NFMdaemon software.


                   The I/PDU Client Nodes

               Nodename       __________________
               Username       __________________
               Password       __________________
               Pathname       __________________

               Nodename       __________________
               Username       __________________
               Password       __________________
               Pathname       __________________ 

Loading I/NFM

The following prompts appear when downloading I/NFM
software,

Install I/NFM Forms Combined Client/Server Software? (y/n/h) [n]
Install I/NFM Alphanumeric Combined Client/Server Software? (y/n/h) [n]
Install I/NFM Server Software? (y/n/h) [y]

Key in y to load the I/NFM multi-user server software.

Install I/NFM PC Software? (y/n/h) [y] 
Install I/NFM Workflow Generator? (y/n/h) [y]
Install I/NFM Administrator Utility? (y/n/h) [y] 
Install I/NFM Bulk Loader? (y/n/h) [y]
Install I/NFM 2.1 to 3.0 Schema Converter? (y/n/h) [y] 
Install I/NFM Forms User Interface? (y/n/h) [y]
Install I/NFM Help for the Forms Interface? (y/n/h) [y]
Install I/NFM Alphanumeric Interface? (y/n/h) [y]
Install I/NFM Command Line Interface? (y/n/h) [y]

Note:

RESPOND TO EACH PROMPT AS INDICATED ABOVE FOR THE PDM SERVER.  RESPOND n
to each when
loading software on the client machines.

If you keyed in n to all of the above prompts, the following prompt
appears.

Install I/NFM File Server and Utility Software? (y/n/h) [y]

Note:

This is the software that will be needed to load on all I/PDU client
workstations.

The following files will be be generated:

        /etc/nfmd.conf
        /etc/init.d/nfm

Installing I/PDM

The following prompts appear when you download I/PDM,

Install the standard I/PDM platform locally (y/n)? [y]
Install the 2.1.0 release of I/PDM (y/n)? [y]
Install the I/PDM Help Files locally (y/n)? [n]
The installation will write an entry into the /etc/nfmd.conf file
and also an entry in the /usr/ip32/inc/server.dat file.

Backup of Database/Storage Areas

The following information explains how to back up the
database.

  INFORMIX Standard Engine

    1.1 Log in to the I/PDM server account in which the database(s) resides.
        [nfmadmin]

    1.2 To backup to tape:

      a. Key in find <env> -print | cpio -omv -O /dev/rmt/rt0

      b. Key in find <userdb>.dbs -print | cpio -omv -O /dev/rmt/rt0

    1.3. To backup to disk:
         To backup the entire disk use the diskcopy utility.

      a. Key in find <env> -print | cpio -omv | compress > /usr#/<env>.cpio

      b. Key in find <userdb>.dbs -print | cpio -omv | compress >
         /usr#/<userdb>.cpio

  OnLine Engine

    1.1 Log in to the I/PDM server account in which the database(s) resides.
        [nfmadmin]

    1.2 To backup to tape:

      a. Key in find <env> -print | cpio -omv -O /dev/rmt/rt0

      b. key in dbexport <userdb>

      c. key in find <userdb.exp> -print | cpio -omv -O /dev/rmt/rt0

    1.3 To backup to disk

      a. Key in find <env> -print | cpio -omv | compress > /usr#/<env>.cpio

      b. key in dbexport <userdb>

      c. key in find <userdb.exp> -print | cpio -omv | compress > /usr#/<userdb          .cpio


    1.4 To archive the database:

      a. Log in as informix

      b. Allocate the tape drive

      c. Make sure that the tape device (/dev/rmt/rt0) on the database machine
         has read and write privileges

      d. Access the tbmonitor utility

      e. Select the archive option
         -  Level 0 is full database archive
         -  Level 1 is Logical log archive
         -  Level 2 is an incremental archive

      f. Select the tape parameters option

      g. Set the tape devie and the tape size

      h. Select the create option

      i. Select the appropriate archive level which should be zero

      j. Deallocate the tape drive at completion

    

  ORACLE:

    To export an ORACLE database

    1.1 Key in EXP <userdb> <username/passwd>

    To import an ORACLE database

    1.2 Key in IMP <userdb> <username/passwd>

  For additional information about backing up a database see the appropriate
  Relational Database Management Systems Administrators Guide.


2.0 Converter Requirements

    2.1 In the PDM1.4.x conversion to PDM2.1.x there is no need to initialize 
        a new environment and database. Risupgrade utility should be run
        before you run the PDM1.4.x -> PDM2.1.x convertor. The procedure to
        run the risupgrade utility is explained later.

    2.2 The converter executable /usr/ip32/pdm/bin/PDMcvt14 must be owned by
        root, group sys with sticky bit set. To set the sticky bit do the
        following:

        a. Become superuser

        b. Key in chmod 6775 PDMcvt14

    2.3 All files must be checked in

    2.4 All users must be logged out of I/PDM software

    2.5 Disk Space requirments
        The converted database will require an additional 10% more disk space
        than the existing database. For example, if the 1.4.x schema took
        100,000 blocks of disk space, the 2.1.x schema will require 110,000
        blocks of disk space.

    2.6 It is recommended to have a dedicated machine for the converter 
        without any interruption from other memory resident processes. 

    2.7 There is no need to move the design files. The converter assumes that
        all files are checked in and creates a checkin storage area.

    2.8 If for some reason the converter terminates abnormally (power failure
        or system crash), restart the converter and it will resume at point
        of termination.

    2.9 If the RDBMS is INFORMIX, it is not required but recommened that the 
        convert be run with OnLine engine for best performance. If you are 
        planning on converting the database from Standard Engine to OnLine 
        Engine follow these steps.

         2.9.1 Export the data
               key in dbexport <userdb>

         2.9.2 Newprod informix OnLine Engine

         2.9.3 Initialize Informix OnLine Engine

         2.9.4 Import the data
               key in dbimport <userdb>

         2.9.5 Change the database logging mode to ANSI
          2.9.5.1 Login as informix user.
          2.9.5.2 Kickoff tbmonitor[  $tbmonitor ]
          2.9.5.3 Bring the engine to quiescent mode [ Refer Informix manual ]
          2.9.5.3 Change the logging mode of the databases 
                  From the main menu
                  Goto Logical-Logs option
                  Goto databases option
                  Select the databases pdm and <userdb>
                  Select Inbuffered Logging, Mode Ansi
                  Exit        


3.0 Estimated Conversion Time

  The approximate time for the conversion depends on the size of the
  database. Plan your converion on the lean period of your design process.
  You need the following information to estimate your conversion time.

  Timings on a C100 chipset[ IP32C, IP220 ]
   x - Total number of parts in the database
   y - Total number of catalogs in the database
   z - Number of rows in the pdmcit table
   b - Number of boms created

   T =   Time for conversion in seconds = (x * .2) + (y * 150) +  (z * 3) +
         (b * 120) + 5% of this time for other data conversion

   D = Days needed to convert = T/86400 

  For example:
   8000   - Total number of parts in the database
   50     - Total number of catalogs in the database
   1000   - Number of rows in the pdmcit table
   50     - Number of boms created

  Total time in seconds =  ( 8000 * .2) + (50 * 150) + (1000 * 3) + (50 * 120)
   = 18100 secs + (.05 * 18100) = 19005 secs

   Days = 19005/86400 = .21  ~ 5.2 hours

  Timings on a C300 chipset[ 6000, 6240, 2000 ]


   x - Total number of parts in the database
   y - Total number of catalogs in the database
   z - Number of rows in the pdmcit table
   b - Number of boms created

   T =   Time for conversion in seconds = (x * .1) + (y * 120) +  (z * 2) +
         (b * 90) + 5% of this time for other data conversion

   D = Days needed to convert = T/86400 

  For example:

   8000   - Total number of parts in the database
   50     - Total number of catalogs in the database
   1000   - Number of rows in the pdmcit table
   50     - Number of boms created

  Total time in seconds =  ( 8000 * .1) + (50 * 120) + (1000 * 2) + (50 * 90)
   = 13300 secs + (.05 * 13300) = 13965 secs

   Days = 13965/86400 = .16 ~ 3.7 hours

risupgrade Utility

All existing RIS schemas must be converted to the 3.0.*
schema format.  The risupgrade utility is provided for this
purpose. This utility will convert schemas from RIS 2.1.* format to
RIS 3.*.* format.  Schemas in 1.3.7 or earlier formats must first be
converted to 2.1.* format.  The following steps explain how to
execute the risupgrade utility.

1.   Log into the nfmadmin account.

2.   At the dollar prompt, key in /usr/ip32/ris/bin/risupgrade
     <schemaname.passwd>

Note:

Input required will be the schema name and schema
password.

If the risupgrade fails for some reason, do the following:

1.   Retrieve your present schema name, password, and node
     name.

2.   Remove the entries in the /usr/ip32/ris/risschema file that
     point to you database and schema.  This can be done with a
     text editor.  Do not delete the CHECKSUM and TIMESTAMP
     entries.  You will correct these entries in step 3.  The
     following illustrates the contents of the
     /usr/ip32/ris/risschema file.

     CHECKSUM:1417103904
     TIMESTAMP:713736519
 -------------------------------------------------------------------------------

   DBID=3 DTYPE=X DBNAME=fluidsnfm PROTOCOL=X NETADDR=000134bb.08-00-36-a6-cd-00
     PROTOCOL=T NETADDR=129.135.172.162 PROTOCOL= NETADDR= PROTOCOL= NETADDR=
     DIR=/usr/informix SQLEXEC=/usr/informix/lib/sqlturbo DBTEMP= TBCONFIG=
 -------------------------------------------------------------------------------
     SCHNAME=fluidsnfm USR=nfmadmin
     USRPASS=zw~~spTr;NNCS@Bi""Wurt=ScSHEGudtRAA9BEGIN_GRANTEES
     END_GRANTEES DBID=3 

3.   To correct the timestamp and checksum entries execute
     one of the following methods.

     Risschema_mgr:

     a.   Key in /usr/ip32/ris/bin/risschema_mgr.

     b.   Select Schema File.

          A new form appears.

     c.   Select Checksum File.

     OR

     Interactive Ris:

     a.   Key in /usr/ip32/ris/bin/ris.

          The Ris prompt appears.

     b.   Key in checksum schema file.

          The schema file is recalculated and the Ris prompt
          appears.

     c.   Key in quit.

4.   Drop the ristables through the RDBMS utility.  For example,
     isql for INFORMIX.

5.   Create the risschema through RIS.  This can be
     accomplished by using the risschema_mgr utility or
     interactive ris.

     Risschema_mgr:

     a.   Key in: /usr/ip32/ris/bin/risschema_mgr.

          A form appears.

     b.   Select Create Schema.

     c.   Key in: Schema Name.

     d.   Key in: Schema Password.

     e.   Key in: User Name

          This is the administrator account nfmadmin

     f.   Key in: User Password

          This is the administrator account password.

     g.   Place a data point on Local Machine.

          This will place the PDM server Internet and Ethernet
          addresses in the appropriate fields.

     h.   Place data point in the appropriate Database box.

     i.   Key in your database name in the box labeled Database
          Name.

     j.   Key in the location of your RDBMS software in the
          Database Management System Location  box.

          For example:  /usr/informix

     k.   Key in your SQLEXEC.

          For example:  /usr/informix/lib/sqlexec

     l.   Place data point on the execute button.

          The Schema is being created.

     m.   When complete, proceed with the conversion.

     Interactive Ris:

     a.   Key in /usr/ip32/ris/bin/ris.

          The Ris prompt appears.

     b.   Key in:

          Create schema
          <your_schema_name>.<your_schema_password> on
          database (<your_RDBMS>, dbname
          <your_database_name>, dir
          <location_RDBMS_software>, remote
          <your_protocol> <your_pdmserver_nodename>)) user
          nfmadmin.<password>;

          Upon successful completion, the Ris prompt is
          displayed.

     c.   Key in: quit.

     d.   Proceed with the conversion.


4.0 I/PDM Conversion

  Running the Converter

    4.1 Log into the administrator account [nfmadmin]

    4.2 key in /usr/ip32/pdm/bin/PDMcvt14 to invoke the converter
        If you have already run the NFM 3.0 convertor on the PDM 1.4.x
        database, kickoff the PDMcvt14 from <nfmadmin> account. It will
        pickup from where NFM convertor has finished and convert the
        remaining data.

    The following menu is displayed.


                          I/PDM 1.4.x to 2.1.x CONVERTER

          Environment name           [1.4x_env                          ]
          Username                   [nfmadmin                          ]
          Password                   [                                  ]
          PDM/SQL Debug              [/dev/null                         ]
          MEM Debug                  [                                  ]









                    -----------------------------------

                    Control C - To Terminate Conversion now
                    PF1       - To Resume Conversion now
                    Backspace/Delete - To delete

    4.3 Enter the Environment Name, Username and Password for the database
        that you want to convert.

    4.4 Press the <PF1> key to accept the information.

   
     The following menu is displayed.


                         SELECTION MENU

          PDM/NFM System Tables      [n                                 ]
          Catalogs & Templates       [n                                 ]
          Workflow                   [n                                 ]
          Search/Sort Criteria       [n                                 ]
          Programs/Processes         [n                                 ]
          View tables                [n                                 ]
          Dynamic tables             [n                                 ]
          Assemblies                 [n                                 ]
          BOMs                       [n                                 ]
          Convert to 2.1             [n                                 ]
          Completion Check & Cleanup [n                                 ]



                    -----------------------------------

                    Control C - To Terminate Conversion now
                    PF1       - To Resume Conversion now
                    Backspace/Delete - To delete


    4.5 Key in y for the tables you want to convert.
        The tables must be converted in the order that they appear

    4.6 Press the <PF1> key to resume the conversion or <Ctrl> c to
        terminate the conversion.

       If you have selected the catalogs, then following menu will appear

     <Enter> to Select; <PF1> to Accept; <PF4> to Accept All; <PF3> to Cancel

                        Catalogs to be converted

     billtest        vlv_plug
     pdmlibraries    vlv_chekc
     test1           c_filter
     assy_175        vlv_slimline
     050t_150        vlv_needle
     075t_025        vlv_throttle
     100t_125        vlv_meter
     150t_075        vlv_vacuum
     2005_062        vlv_oper
     250t_050        vlv_globe
     300t_037        vlv_b_fly
     350t_200        vlv_dome_reg
     400_angle       vlv_pneu
     miscball        vlv_solenoid


     The following menu is displayed.


     <Enter> to select; <PF1> to Accept; <PF4> to Accept All; <PF3> to Cancel

         Date formats to be converted from char to timestamp

      p_creationdate   p_updatedate
      P_rev_data       p_mrpdate


     This is a list of date attributes which appear in the database.
     If you do not select an attribute, then it will retain the char format.
     If there are date attributes which are not in a format (ANSI, American, 
     British) then a system generated date will replace the corrupted date 
     format.


    4.7 Hightlight the attributes to be converted and press <PF1> to convert
        the attributes ,press <PF4> to convert all attributes or press
        <PF3> to cancel.

        A menu of all the Catalogs to be converted is displayed.

    4.8 Hightlight the catalogs to be converted and press <PF1> to convert
        the attributes ,press <PF4> to convert all attributes or press
        <PF3> to cancel.

    4.9 After the database is converted the nfmconvertlog table is displayed
        with the status of the 1.4.x to 2.0.x conversion. If the database
        was converted to 2.1.x the cvtlog table is displayed with the
        status of the 2.0.x to 2.1.x conversion.

    4.10 Check the current working directory [nfmadmin] for the existance
        of a file CVTbad_in.ris. If this file exist it will contain
        information about the data in the original database that could not
        be converted. This file can be edited and fixes applied directly to
        this file. After the file has been edited and fixes made use 
        interactive ris to run this file.

        /usr/ip32/ris/bin/ris < CVTbad_in.ris

     4.11 There are several files that are generated and used when the
          I/PDM converter is run.  The following lists these files.

Files Generated   Files Used

CVTcat.sh         /usr/ip32/nfm/config/convert
CVTtable.sh       cvt30.dmp
cvt.dmp           s_tables.dmp
Table.dmp

9.   Convert log table.

There is a nfmconvertlog table that is created at the beginning
of the conversion process. After the database has been
converted, the status of tables in the nfmconvertlog table
should be:

nfmactivity       C
nfmarchives       C
nfmattributes     M
nfmcatalogs       M
nfmsignoff        M
nfmcommands       M
nfmnodes          C
nfmprocesses      M
nfmprograms       N
nfmprojects       M
nfmreports        N
nfmsafiles        C
nfmsavesets       M
nfmstoragearea    M
nfmvalues         M
nfmlists          M
nfmworkflow       M

nfmacls           M
nfmtables         M
nfmstates         M
nfmsyscat         N
nfmtransitions    M
nfmusers          C
nfmsysattributes  C

catalogs          C
viewtables        C
dynamic tables    C
PDMCIT            C
BOMS              C

If the status value is different than this, you should contact
I/PDM support.  The following describes the ten different
status values.

If status = B, the convert of this table is beginning.
If status = E, an error or interrupt occurred.
If status = U, the old table is unloaded.
If status = D, the old table has been dropped.
If status = R, the old table has been renamed in the dump file.
If status = T, the old table is loaded.
If status = N, the new table is created from the template.
If status = Z, the new table is created from the template with indexes.
If status = M, the new table has been loaded with data from old table.
If status = C, the table has been converted successfully.

5.0  Converting the parametric macros

     All macro libraries must be edited before they can be used in a 2.1.x 
     database. A ppl script is provided in /usr/ip32/pdu/ppl/bin called 
     edit_macro.

     5.1 Enter ems
     5.2 Choose the PDM button
     5.3 Check out the macro libraries to the current working storage area
     5.4 Logout of PDM
     5.5 On the ems command line enter edit_macro
     5.6 Enter the macro library name
     5.7 Enter each macro to be converted or "*" for all
     5.8 Choose the PDM button
     5.9 Checkin the edited macro libraries
 
