# make.all - This is the driver function for GRNUC that calls all the
#            subscripts that do what the old make.all used to do.
#            In other words, this is make.all.
#
#
#    Usage       : make.all
#    Inputs      : none
#    Outputs     : none
#    Return code : 1 - error
#
#    NOTE : The first step in designing this script was to simply separate
#           the old make.all script into pieces with each piece being in
#           a separate script.  This will allow each unit to be tested and
#           executed independently.
#
#$Log: make.all,v $
#Revision 1.3  2002/03/28 20:46:52  hans
#cci (PPL compiler) problem solved
#
#Revision 1.2  2002/02/06 23:31:33  hans
#Cancelled grmkpplsrc.sh (until cci runtime problem is fixed!!)
#
#Revision 1.1.1.1  2001/12/17 22:40:07  hans
#Initial import to CVS
#
# Revision 340.0  1997/05/27  22:07:13  root
# COMMENT : Initial checkin to 3.4.0 RCS from 3.3.0 src
#
# Revision 330.0  1996/01/11  20:22:52  root
# COMMENT : Initial checkin to 3.3.0 RCS from 3.2.0 src
#
# Revision 320.0  1994/12/12  16:57:18  root
# COMMENT : Initial checkin to 3.2 RCS from 3.1 src
#
# Revision 240.20  1993/10/14  21:12:36  dodd
# COMMENT : Removing lg, gde, and gpipe references from Solaris and Irix5 builds - JSD
#
# Revision 240.19  1993/09/08  21:49:23  grnuc20
# COMMENT : Removing the call to fetchtrans since their code is now in our RCS tree - JSD
#
# Revision 240.18  1993/06/29  15:22:22  grnuc20
# COMMENT : check for duplicate messages in build process
#
# Revision 240.17  1993/06/11  20:49:28  grnuc20
# COMMENT : added INGRHOME/include to the include path
#
# Revision 240.16  1993/05/05  19:56:02  tim
# COMMENT : corrected Log variable used to pull in RCS history with each checkin
#


# verify that all environment variables used in this script are defined.
verifyenv GRNUC GRTARG
if [ $? -ne 0 ]
then
  errrpt $0 "Some environment variables are NOT defined....Exiting..."
  exit 1
fi

if [ "$UNIT_TEST" = "on" ]
then
  echo "\n---------- Running GRNUC build script in UNIT_TEST mode ----------\n"
fi

if [ "$CLIPPER" = "y" ]
 then
  necho "\n...Making translator files executable"
  chmod +x $GRNUC/tr/makedir/oplclean
  chmod +x $GRNUC/tr/bin/*
fi

#############################################################################
#      Copy Intergraph unix extension include files to $GRNUC/ingrsys
#############################################################################
gringrsys.sh


#############################################################################
#           Copy or link special files to $GRTARG (not include files)
#############################################################################
grcpspl.sh

#############################################################################
#             Copy special include files to $GRTARG/unix_include
#############################################################################
grcpunixinc.sh

#############################################################################
#            Compile $GRNUC/config/english/message/src/*.mb files
#############################################################################
grmkmess.sh

#############################################################################
#                         Slic all .sl and .t files
#############################################################################
grmkcob.sh

#############################################################################
#                            Make the makefiles
#############################################################################
grmkmk.sh

#############################################################################
#              Make the pplsrc (generates a new $GRTARG/bin/cci)
#############################################################################
#CANCELED until cci problem is resolved
#03/28/2002 problem solved
grmkpplsrc.sh

#############################################################################
#              Make the translator directory 
#############################################################################
maketrans.sh

#############################################################################
#                          Make the fontbuilder 
#############################################################################
grmkfntbld.sh

#############################################################################
#                    Compile the source code for GRNUC
#############################################################################
grmksrc.sh

#############################################################################
#         Make the archive libraries (libGRcoar.a and libGRgrar.a)
#############################################################################
grmkarch.sh

#############################################################################
#         Make the dictionary (generates $GRTARG/config/class_defns)
#############################################################################
grmkdict.sh

#############################################################################
#                         Chk for duplicate messages
#############################################################################
grchkmsg.sh

if [ "$UNIT_TEST" = "on" ]
then
  necho "\n---------- GRNUC UNIT_TEST COMPLETE ----------\n"
  grep ERROR /usr2/tmp/$MASBLDLOG > /usr2/tmp/masbld.err 2>&1
  if [ "$?" != 1 ]
  then
    cat /usr2/tmp/masbld.err >> /usr2/tmp/$MASBLDLOG
    necho "\n\n\nGRNUC UNIT_TEST failed because of :\n"
    cat /usr2/tmp/masbld.err
  else
    necho "\n\n\nGRNUC UNIT_TEST was successful\n"
  fi
fi
