# Info
# Script to format ws_*.prods file(s).  Checks fixes.com date in 
# product directory against date in prod file for disparity. 	
# Notifies user if dates are different.

showprod() {
	IFS="#"
	set -- $1
	IFS="$OIFS"

	prodnum=$1
	prodtitle=$2
	proddate=$3
	prodsize=$4
	prodflags=$5
	hostdir=$6
	deldir=$7
	delloadp=$8
	prodname=$9
	shift 9
	prodversion=$1
	prodclass=$2
	delattr=$3
	delarch=$4
	
	echo "\nProduct Number: $prodnum		Title: $prodtitle"

	. $hostdir/product.def

	[ `expr "$proddate" : ".*"` -lt 11 ] && DATE="0$proddate"

	echo "Class: $prodclass"
	echo "Version: $prodversion	Size: $prodsize	Priority: $delloadp"
	echo "Date: $proddate			Product Date: $IDdate"
	echo "Host Directory: $hostdir"
	echo "Local Directory: $deldir"
	echo "Target Architecture: $delarch"
	[ $IDdate != $proddate ] && echo "\t**** Needs to be initialized ****\007"
}
 
#	Get options to ws_info
set -- `getopt "f:" $*`
while [ $1 != "--" ]
do
	case $1 in
	-f)
		FILENAME="$2"
		shift 2
		;;
	esac
done
shift

#	Get filename if not provided by option -f
if [ -z "$FILENAME" ]
then
	echo "Enter prodlist filename [ws_s.prods]: \c"
	read FILENAME
	: ${FILENAME:=ws_s.prods}
fi

#	Find out if file exists
if [ ! -f $FILENAME ]
then
	echo "$0: $FILENAME not found."
	exit 
fi

OIFS="$IFS"
if [ $# -ne 0 ]
then
	for pattern in $*
	do
		grep -i "$pattern" $FILENAME | while read line
		do
			showprod "$line"
		done
	done 
else
	while read line
	do
		showprod "$line"
	done <$FILENAME
fi
