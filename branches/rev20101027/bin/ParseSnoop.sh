#!/bin/ksh

# $Id: ParseSnoop.sh,v 1.1 2002/05/13 18:37:04 anand Exp $

# I/ROUTE
#
# File:	ParseSnoop.sh
#
# Description:
#	snoop is an UNIX command that lets one monitor network traffic
#	(capture and inspect network packets).  When an offset of 0 is
#	given as an option for this command ( snoop -x0 ), packet data
#	is generated both in hexadecimal and ASCII format.  The ASCII
#	portion is between columns 51 and 66.
#	When snoop is run when ISDP is up, it also captures all the SQL
#	queries that ISDP makes.  This script strips out all the
#	"Select" queries from the output file generated by snoop.
#
# Dependencies:
#
# Revision History:
#	$Log: ParseSnoop.sh,v $
#	Revision 1.1  2002/05/13 18:37:04  anand
#	Relocating ParseSnoop.sh
#	from isdp/route/etc/bin to isdp/vds/bin
#	
#	Revision 1.4  2001/10/04 17:09:25  anand
#	*** empty log message ***
#	
#	Revision 1.3  2001/10/03 15:49:38  anand
#	*** empty log message ***
#	
#	Revision 1.2  2001/09/24 18:22:33  anand
#	*** empty log message ***
#	
#	Revision 1.1  2001/09/24 18:17:45  anand
#	*** empty log message ***
#	
# History:
#	MM/DD/YY	AUTHOR		DESCRIPTION
#
#	09/18/01	Anand		creation
#	09/19/01	Anand		Processing status in stderr
#	09/24/01	Anand		Improvements
#	10/04/01	Anand		Remove leading dot and other junk
#					characters from the "select" (or
#					"SELECT" or "Select") word even when
#					it gets broken in between as its
#					spills over to the next line. Be
#					careful to avoid the underscore
#					character ('_') as a junk leading
#					character (as in "_select"), as this
#					could be a table name (as in
#					hvac_br_select)!
#

SCRFILE=/var/tmp/$RANDOM

if [ $# -ne 1 ]  
then
	echo
	echo "Usage:"
	echo "$ `basename $0` file_name"
	echo "where file_name was generated by"
	echo "# snoop -i snoop.log -x0 > file_name"
	echo
	exit
fi

if [ ! -f $1 ]  
then
	echo `basename $0`: Unable to open ${1} to read.
	exit
fi

printf "Working on %s .." "$1" > /dev/stderr

cut -c51-66 $1 > $SCRFILE

printf "...." > /dev/stderr

sed -n '/\<[sS]\n*[eE]\n*[lL]\n*[eE]\n*[cC]\n*[tT]/,/^$/ {
/^$/ !{
H
}
/^$/ {
x
s/\n//g
s/^.*[^_]\([sS][eE][lL][eE][cC][tT]\)/\1/
p
}
}' $SCRFILE

printf ".." > /dev/stderr

/bin/rm $SCRFILE

printf " done!\n\n" > /dev/stderr

