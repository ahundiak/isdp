
/*
$Author: hans $
$Revision: 1.1.1.1 $
$Date: 2001/12/17 22:40:41 $
$Locker:  $
*/

/*  HRpower:  entry points for HRpower and HRinterpolate.
 *
 *    HRpower:  given a <1:15> fixed point integer value in the range [0..32768]
 *      and an integer exponent in the range [1..255], this function returns
 *      (value ^ power) as a <1:15> fixed point integer value in the range
 *      [0..32768].
 *
 *    HRinterpolate:  given an interpolation value, an exponent (index into
 *      lookup table), a sub-table number, and the low index for the range
 *      within which we're to interpolate, this function returns an
 *      interpolated value from the static arrays define below.
 *
 *  Author:  D. H. Holmes				Date:  7/17/89
 *
 *  Modified:  8/21/89 - changed double precision floating point divisions to
 *               integer divisions to accomplish the interpolations; the
 *               average error of the result is 0.020% and the maximum error
 *               of the result is 0.843%.
 */

#include <stdio.h>
#include "wl.h"

#include "OMminimum.h"
#include "igetypedef.h"
#include "igrtypedef.h"
#include "igr.h"
#include "gr.h"

#include "hslight.h"
#include "hsdisplay.h"
#include "hrstruct.h"

#include "HSpr_render.h"


/*
 *  Prototype declaration for static functions
 */


#if defined (__) 
#undef __
#endif

#if defined(__STDC__) || defined(__cplusplus)
#define __(args) args
#else
#define __(args) ()
#endif

#if defined(__cplusplus)
extern "C" {
#endif

/* HRpower.c */
static int HRinterpolate __((	int i_val, 
				int expon, 
				int tbl_num, 
				int indx));

#if defined(__cplusplus)
}
#endif


#undef __



  static short threshold[3][2] = { 14,  3010,  65, 23833, 255, 30480};
      /* table is divided into 3 subtables:  powers 2-14, 15-65, 66-255.   */
      /*   Thus, we need 3 "power thresholds" (14, 65, 255).  We also need */
      /*   a "zero threshold" for each subtable, below which we return 0.  */

  static short lookup[3][15] = {
      /* 0 */     4396,  8792, 13176, 16921, 20097, 22726, 24858, 26566,
                    27924, 28995, 29872, 30616, 31266, 31843, 32364,
      /* 1 */    23936, 26313, 27796, 28894, 29755, 30429, 30954, 31363,
                    31680, 31926, 32124, 32290, 32433, 32558, 32670,
      /* 2 */    30510, 31161, 31547, 31824, 32038, 32203, 32331, 32430,
                    32507, 32566, 32615, 32655, 32690, 32721, 32749};

  static unsigned char table[256][15] = {
      /*   0 */      0,   0,   0,   0,   0,   0,   0,   0,  /* not used */
                        0,   0,   0,   0,   0,   0,   0,
      /*   1 */      0,   0,   0,   0,   0,   0,   0,   0,  /* not used */
                        0,   0,   0,   0,   0,   0,   0,
      /*   2 */      5,  18,  41,  68,  96, 123, 147, 168,
                      185, 200, 212, 223, 232, 241, 249,
      /*   3 */      1,   5,  17,  35,  59,  85, 111, 136,
                      158, 177, 193, 208, 222, 234, 246,
      /*   4 */      0,   1,   7,  18,  36,  59,  84, 110,
                      134, 156, 176, 194, 211, 227, 243,
      /*   5 */      0,   0,   3,   9,  22,  41,  64,  89,
                      115, 138, 161, 182, 202, 221, 240,
      /*   6 */      0,   0,   1,   5,  14,  28,  49,  72,
                       98, 122, 146, 170, 192, 215, 237,
      /*   7 */      0,   0,   0,   2,   8,  20,  37,  59,
                       83, 108, 133, 159, 184, 209, 234,
      /*   8 */      0,   0,   0,   1,   5,  14,  28,  48,
                       71,  96, 122, 148, 175, 203, 231,
      /*   9 */      0,   0,   0,   1,   3,   9,  21,  39,
                       60,  85, 111, 138, 167, 197, 228,
      /*  10 */      0,   0,   0,   0,   2,   7,  16,  31,
                       52,  75, 101, 129, 160, 192, 225,
      /*  11 */      0,   0,   0,   0,   1,   5,  12,  25,
                       44,  66,  92, 121, 152, 186, 223,
      /*  12 */      0,   0,   0,   0,   1,   3,   9,  21,
                       37,  59,  84, 113, 145, 181, 220,
      /*  13 */      0,   0,   0,   0,   0,   2,   7,  17,
                       32,  52,  77, 105, 139, 176, 217,
      /*  14 */      0,   0,   0,   0,   0,   2,   5,  14,
                       27,  46,  70,  99, 132, 171, 214,
      /*  15 */      2,   9,  22,  39,  60,  84, 109, 132,
                      154, 173, 189, 205, 219, 232, 244,
      /*  16 */      2,   8,  18,  34,  55,  78, 103, 127,
                      149, 168, 186, 202, 216, 230, 243,
      /*  17 */      1,   6,  16,  30,  50,  72,  97, 121,
                      144, 164, 182, 199, 214, 229, 242,
      /*  18 */      1,   5,  13,  26,  45,  67,  92, 116,
                      139, 160, 179, 196, 212, 227, 242,
      /*  19 */      1,   4,  11,  23,  41,  62,  86, 111,
                      134, 156, 175, 193, 210, 226, 241,
      /*  20 */      0,   3,   9,  21,  37,  58,  82, 106,
                      130, 152, 172, 190, 208, 224, 240,
      /*  21 */      0,   3,   8,  18,  34,  54,  77, 102,
                      126, 148, 168, 187, 206, 223, 240,
      /*  22 */      0,   2,   7,  16,  31,  50,  73,  97,
                      121, 144, 165, 185, 203, 221, 239,
      /*  23 */      0,   2,   6,  14,  28,  46,  69,  93,
                      117, 140, 162, 182, 201, 220, 238,
      /*  24 */      0,   1,   5,  12,  25,  43,  65,  89,
                      113, 137, 159, 179, 199, 219, 237,
      /*  25 */      0,   1,   4,  11,  23,  40,  61,  85,
                      110, 133, 155, 177, 197, 217, 237,
      /*  26 */      0,   1,   4,  10,  21,  37,  58,  82,
                      106, 130, 152, 174, 195, 216, 236,
      /*  27 */      0,   1,   3,   9,  19,  35,  55,  78,
                      103, 126, 149, 172, 193, 215, 235,
      /*  28 */      0,   1,   3,   8,  17,  32,  52,  75,
                       99, 123, 146, 169, 191, 213, 235,
      /*  29 */      0,   0,   2,   7,  16,  30,  49,  72,
                       96, 120, 144, 167, 189, 212, 234,
      /*  30 */      0,   0,   2,   6,  14,  28,  46,  69,
                       93, 117, 141, 164, 187, 210, 233,
      /*  31 */      0,   0,   2,   5,  13,  26,  44,  66,
                       90, 114, 138, 162, 186, 209, 233,
      /*  32 */      0,   0,   1,   5,  12,  24,  41,  63,
                       87, 111, 135, 159, 184, 208, 232,
      /*  33 */      0,   0,   1,   4,  11,  22,  39,  60,
                       84, 108, 133, 157, 182, 206, 231,
      /*  34 */      0,   0,   1,   4,  10,  21,  37,  58,
                       81, 105, 130, 155, 180, 205, 230,
      /*  35 */      0,   0,   1,   3,   9,  19,  35,  55,
                       78, 103, 127, 153, 178, 204, 230,
      /*  36 */      0,   0,   1,   3,   8,  18,  33,  53,
                       76, 100, 125, 150, 176, 202, 229,
      /*  37 */      0,   0,   1,   2,   7,  16,  31,  50,
                       73,  97, 123, 148, 174, 201, 228,
      /*  38 */      0,   0,   0,   2,   7,  15,  29,  48,
                       71,  95, 120, 146, 173, 200, 228,
      /*  39 */      0,   0,   0,   2,   6,  14,  28,  46,
                       68,  93, 118, 144, 171, 199, 227,
      /*  40 */      0,   0,   0,   2,   5,  13,  26,  44,
                       66,  90, 115, 142, 169, 197, 226,
      /*  41 */      0,   0,   0,   1,   5,  12,  25,  42,
                       64,  88, 113, 140, 167, 196, 226,
      /*  42 */      0,   0,   0,   1,   4,  11,  23,  41,
                       62,  86, 111, 138, 166, 195, 225,
      /*  43 */      0,   0,   0,   1,   4,  11,  22,  39,
                       60,  83, 109, 136, 164, 194, 224,
      /*  44 */      0,   0,   0,   1,   4,  10,  21,  37,
                       58,  81, 107, 134, 162, 192, 224,
      /*  45 */      0,   0,   0,   1,   3,   9,  20,  36,
                       56,  79, 105, 132, 161, 191, 223,
      /*  46 */      0,   0,   0,   1,   3,   8,  19,  34,
                       54,  77, 103, 130, 159, 190, 222,
      /*  47 */      0,   0,   0,   1,   3,   8,  18,  33,
                       52,  75, 101, 128, 157, 189, 222,
      /*  48 */      0,   0,   0,   1,   2,   7,  17,  31,
                       51,  73,  99, 126, 156, 188, 221,
      /*  49 */      0,   0,   0,   1,   2,   7,  16,  30,
                       49,  71,  97, 124, 154, 186, 220,
      /*  50 */      0,   0,   0,   0,   2,   6,  15,  29,
                       47,  70,  95, 122, 153, 185, 220,
      /*  51 */      0,   0,   0,   0,   2,   6,  14,  27,
                       46,  68,  93, 121, 151, 184, 219,
      /*  52 */      0,   0,   0,   0,   2,   5,  13,  26,
                       44,  66,  91, 119, 150, 183, 218,
      /*  53 */      0,   0,   0,   0,   2,   5,  12,  25,
                       43,  64,  89, 117, 148, 182, 218,
      /*  54 */      0,   0,   0,   0,   1,   5,  12,  24,
                       41,  63,  87, 116, 147, 180, 217,
      /*  55 */      0,   0,   0,   0,   1,   4,  11,  23,
                       40,  61,  86, 114, 145, 179, 216,
      /*  56 */      0,   0,   0,   0,   1,   4,  11,  22,
                       39,  59,  84, 112, 144, 178, 216,
      /*  57 */      0,   0,   0,   0,   1,   4,  10,  21,
                       37,  58,  82, 111, 142, 177, 215,
      /*  58 */      0,   0,   0,   0,   1,   3,   9,  20,
                       36,  56,  81, 109, 141, 176, 215,
      /*  59 */      0,   0,   0,   0,   1,   3,   9,  19,
                       35,  55,  79, 107, 139, 175, 214,
      /*  60 */      0,   0,   0,   0,   1,   3,   8,  18,
                       34,  54,  78, 106, 138, 174, 213,
      /*  61 */      0,   0,   0,   0,   1,   3,   8,  18,
                       33,  52,  76, 104, 136, 173, 213,
      /*  62 */      0,   0,   0,   0,   1,   3,   7,  17,
                       31,  51,  75, 103, 135, 171, 212,
      /*  63 */      0,   0,   0,   0,   1,   2,   7,  16,
                       30,  50,  73, 101, 134, 170, 211,
      /*  64 */      0,   0,   0,   0,   1,   2,   7,  15,
                       29,  48,  72, 100, 132, 169, 211,
      /*  65 */      0,   0,   0,   0,   0,   2,   6,  15,
                       28,  47,  70,  98, 131, 168, 210,
      /*  66 */      2,   9,  21,  37,  58,  81, 105, 129,
                      151, 170, 188, 204, 219, 233, 246,
      /*  67 */      2,   9,  20,  36,  56,  80, 104, 128,
                      150, 169, 187, 203, 218, 232, 246,
      /*  68 */      2,   8,  19,  35,  55,  78, 103, 126,
                      148, 168, 186, 202, 218, 232, 246,
      /*  69 */      2,   8,  19,  34,  54,  77, 101, 125,
                      147, 167, 185, 201, 217, 232, 246,
      /*  70 */      2,   8,  18,  33,  53,  76, 100, 124,
                      146, 166, 184, 201, 217, 231, 245,
      /*  71 */      2,   7,  17,  32,  52,  74,  99, 122,
                      145, 165, 183, 200, 216, 231, 245,
      /*  72 */      1,   7,  17,  31,  50,  73,  97, 121,
                      144, 164, 182, 199, 215, 231, 245,
      /*  73 */      1,   7,  16,  30,  49,  72,  96, 120,
                      143, 163, 181, 199, 215, 230, 245,
      /*  74 */      1,   6,  15,  29,  48,  71,  95, 119,
                      141, 162, 181, 198, 214, 230, 245,
      /*  75 */      1,   6,  15,  29,  47,  69,  93, 118,
                      140, 161, 180, 197, 214, 230, 245,
      /*  76 */      1,   6,  14,  28,  46,  68,  92, 116,
                      139, 160, 179, 197, 213, 229, 245,
      /*  77 */      1,   5,  14,  27,  45,  67,  91, 115,
                      138, 159, 178, 196, 213, 229, 244,
      /*  78 */      1,   5,  13,  26,  44,  66,  90, 114,
                      137, 158, 177, 195, 212, 229, 244,
      /*  79 */      1,   5,  13,  25,  43,  65,  89, 113,
                      136, 157, 176, 195, 212, 228, 244,
      /*  80 */      1,   5,  12,  25,  42,  64,  87, 112,
                      135, 156, 176, 194, 211, 228, 244,
      /*  81 */      1,   4,  12,  24,  41,  63,  86, 110,
                      134, 155, 175, 193, 211, 228, 244,
      /*  82 */      1,   4,  11,  23,  40,  61,  85, 109,
                      133, 154, 174, 193, 211, 227, 244,
      /*  83 */      1,   4,  11,  23,  39,  60,  84, 108,
                      132, 153, 173, 192, 210, 227, 244,
      /*  84 */      1,   4,  11,  22,  39,  59,  83, 107,
                      131, 152, 172, 191, 210, 227, 243,
      /*  85 */      1,   4,  10,  21,  38,  58,  82, 106,
                      130, 151, 172, 191, 209, 227, 243,
      /*  86 */      1,   3,  10,  21,  37,  57,  81, 105,
                      128, 150, 171, 190, 209, 226, 243,
      /*  87 */      1,   3,   9,  20,  36,  56,  80, 104,
                      127, 149, 170, 189, 208, 226, 243,
      /*  88 */      0,   3,   9,  20,  35,  55,  79, 103,
                      126, 149, 169, 189, 208, 226, 243,
      /*  89 */      0,   3,   9,  19,  34,  54,  77, 102,
                      125, 148, 168, 188, 207, 225, 243,
      /*  90 */      0,   3,   8,  18,  34,  53,  76, 101,
                      124, 147, 168, 188, 207, 225, 243,
      /*  91 */      0,   3,   8,  18,  33,  53,  75, 100,
                      123, 146, 167, 187, 206, 225, 243,
      /*  92 */      0,   3,   8,  17,  32,  52,  74,  99,
                      122, 145, 166, 186, 206, 224, 242,
      /*  93 */      0,   2,   7,  17,  31,  51,  73,  98,
                      122, 144, 165, 186, 205, 224, 242,
      /*  94 */      0,   2,   7,  16,  31,  50,  72,  97,
                      121, 143, 165, 185, 205, 224, 242,
      /*  95 */      0,   2,   7,  16,  30,  49,  71,  96,
                      120, 142, 164, 184, 204, 223, 242,
      /*  96 */      0,   2,   7,  15,  29,  48,  71,  95,
                      119, 141, 163, 184, 204, 223, 242,
      /*  97 */      0,   2,   6,  15,  29,  47,  70,  94,
                      118, 141, 162, 183, 203, 223, 242,
      /*  98 */      0,   2,   6,  15,  28,  47,  69,  93,
                      117, 140, 162, 183, 203, 222, 242,
      /*  99 */      0,   2,   6,  14,  27,  46,  68,  92,
                      116, 139, 161, 182, 202, 222, 241,
      /* 100 */      0,   2,   6,  14,  27,  45,  67,  91,
                      115, 138, 160, 181, 202, 222, 241,
      /* 101 */      0,   2,   6,  13,  26,  44,  66,  90,
                      114, 137, 159, 181, 201, 222, 241,
      /* 102 */      0,   2,   5,  13,  26,  43,  65,  89,
                      113, 136, 159, 180, 201, 221, 241,
      /* 103 */      0,   1,   5,  13,  25,  43,  64,  88,
                      112, 135, 158, 179, 200, 221, 241,
      /* 104 */      0,   1,   5,  12,  25,  42,  63,  87,
                      111, 135, 157, 179, 200, 221, 241,
      /* 105 */      0,   1,   5,  12,  24,  41,  63,  86,
                      110, 134, 156, 178, 199, 220, 241,
      /* 106 */      0,   1,   5,  12,  23,  41,  62,  85,
                      110, 133, 156, 178, 199, 220, 241,
      /* 107 */      0,   1,   4,  11,  23,  40,  61,  84,
                      109, 132, 155, 177, 199, 220, 240,
      /* 108 */      0,   1,   4,  11,  22,  39,  60,  84,
                      108, 131, 154, 176, 198, 219, 240,
      /* 109 */      0,   1,   4,  11,  22,  38,  59,  83,
                      107, 131, 153, 176, 198, 219, 240,
      /* 110 */      0,   1,   4,  10,  21,  38,  58,  82,
                      106, 130, 153, 175, 197, 219, 240,
      /* 111 */      0,   1,   4,  10,  21,  37,  58,  81,
                      105, 129, 152, 175, 197, 218, 240,
      /* 112 */      0,   1,   4,  10,  21,  37,  57,  80,
                      104, 128, 151, 174, 196, 218, 240,
      /* 113 */      0,   1,   4,   9,  20,  36,  56,  79,
                      104, 127, 151, 173, 196, 218, 240,
      /* 114 */      0,   1,   3,   9,  20,  35,  55,  79,
                      103, 127, 150, 173, 195, 218, 240,
      /* 115 */      0,   1,   3,   9,  19,  35,  55,  78,
                      102, 126, 149, 172, 195, 217, 239,
      /* 116 */      0,   1,   3,   9,  19,  34,  54,  77,
                      101, 125, 149, 172, 194, 217, 239,
      /* 117 */      0,   1,   3,   8,  18,  33,  53,  76,
                      100, 124, 148, 171, 194, 217, 239,
      /* 118 */      0,   1,   3,   8,  18,  33,  53,  75,
                      100, 124, 147, 170, 194, 216, 239,
      /* 119 */      0,   1,   3,   8,  18,  32,  52,  75,
                       99, 123, 146, 170, 193, 216, 239,
      /* 120 */      0,   1,   3,   8,  17,  32,  51,  74,
                       98, 122, 146, 169, 193, 216, 239,
      /* 121 */      0,   1,   3,   7,  17,  31,  50,  73,
                       97, 121, 145, 169, 192, 215, 239,
      /* 122 */      0,   1,   2,   7,  16,  31,  50,  72,
                       96, 121, 144, 168, 192, 215, 238,
      /* 123 */      0,   1,   2,   7,  16,  30,  49,  72,
                       96, 120, 144, 168, 191, 215, 238,
      /* 124 */      0,   1,   2,   7,  16,  30,  48,  71,
                       95, 119, 143, 167, 191, 215, 238,
      /* 125 */      0,   0,   2,   7,  15,  29,  48,  70,
                       94, 118, 142, 166, 190, 214, 238,
      /* 126 */      0,   0,   2,   6,  15,  29,  47,  69,
                       93, 118, 142, 166, 190, 214, 238,
      /* 127 */      0,   0,   2,   6,  15,  28,  47,  69,
                       93, 117, 141, 165, 189, 214, 238,
      /* 128 */      0,   0,   2,   6,  14,  28,  46,  68,
                       92, 116, 140, 165, 189, 213, 238,
      /* 129 */      0,   0,   2,   6,  14,  27,  45,  67,
                       91, 115, 140, 164, 189, 213, 238,
      /* 130 */      0,   0,   2,   6,  14,  27,  45,  67,
                       90, 115, 139, 164, 188, 213, 237,
      /* 131 */      0,   0,   2,   6,  13,  26,  44,  66,
                       90, 114, 139, 163, 188, 212, 237,
      /* 132 */      0,   0,   2,   5,  13,  26,  44,  65,
                       89, 113, 138, 163, 187, 212, 237,
      /* 133 */      0,   0,   2,   5,  13,  25,  43,  65,
                       88, 113, 137, 162, 187, 212, 237,
      /* 134 */      0,   0,   2,   5,  13,  25,  42,  64,
                       88, 112, 137, 161, 186, 212, 237,
      /* 135 */      0,   0,   2,   5,  12,  24,  42,  63,
                       87, 111, 136, 161, 186, 211, 237,
      /* 136 */      0,   0,   1,   5,  12,  24,  41,  63,
                       86, 111, 135, 160, 186, 211, 237,
      /* 137 */      0,   0,   1,   5,  12,  24,  41,  62,
                       86, 110, 135, 160, 185, 211, 237,
      /* 138 */      0,   0,   1,   5,  11,  23,  40,  61,
                       85, 109, 134, 159, 185, 210, 236,
      /* 139 */      0,   0,   1,   4,  11,  23,  40,  61,
                       84, 109, 133, 159, 184, 210, 236,
      /* 140 */      0,   0,   1,   4,  11,  22,  39,  60,
                       84, 108, 133, 158, 184, 210, 236,
      /* 141 */      0,   0,   1,   4,  11,  22,  39,  59,
                       83, 107, 132, 158, 183, 210, 236,
      /* 142 */      0,   0,   1,   4,  10,  22,  38,  59,
                       82, 107, 132, 157, 183, 209, 236,
      /* 143 */      0,   0,   1,   4,  10,  21,  38,  58,
                       82, 106, 131, 157, 183, 209, 236,
      /* 144 */      0,   0,   1,   4,  10,  21,  37,  58,
                       81, 105, 130, 156, 182, 209, 236,
      /* 145 */      0,   0,   1,   4,  10,  21,  37,  57,
                       80, 105, 130, 155, 182, 208, 235,
      /* 146 */      0,   0,   1,   4,  10,  20,  36,  56,
                       80, 104, 129, 155, 181, 208, 235,
      /* 147 */      0,   0,   1,   3,   9,  20,  36,  56,
                       79, 103, 129, 154, 181, 208, 235,
      /* 148 */      0,   0,   1,   3,   9,  20,  35,  55,
                       78, 103, 128, 154, 180, 207, 235,
      /* 149 */      0,   0,   1,   3,   9,  19,  35,  55,
                       78, 102, 127, 153, 180, 207, 235,
      /* 150 */      0,   0,   1,   3,   9,  19,  34,  54,
                       77, 102, 127, 153, 180, 207, 235,
      /* 151 */      0,   0,   1,   3,   9,  19,  34,  54,
                       77, 101, 126, 152, 179, 207, 235,
      /* 152 */      0,   0,   1,   3,   8,  18,  33,  53,
                       76, 100, 126, 152, 179, 206, 235,
      /* 153 */      0,   0,   1,   3,   8,  18,  33,  53,
                       75, 100, 125, 151, 178, 206, 234,
      /* 154 */      0,   0,   1,   3,   8,  18,  32,  52,
                       75,  99, 124, 151, 178, 206, 234,
      /* 155 */      0,   0,   1,   3,   8,  17,  32,  51,
                       74,  98, 124, 150, 177, 205, 234,
      /* 156 */      0,   0,   1,   3,   8,  17,  32,  51,
                       74,  98, 123, 150, 177, 205, 234,
      /* 157 */      0,   0,   1,   3,   7,  17,  31,  50,
                       73,  97, 123, 149, 177, 205, 234,
      /* 158 */      0,   0,   1,   3,   7,  16,  31,  50,
                       72,  97, 122, 149, 176, 205, 234,
      /* 159 */      0,   0,   1,   2,   7,  16,  30,  49,
                       72,  96, 122, 148, 176, 204, 234,
      /* 160 */      0,   0,   1,   2,   7,  16,  30,  49,
                       71,  95, 121, 148, 175, 204, 234,
      /* 161 */      0,   0,   1,   2,   7,  16,  30,  48,
                       71,  95, 120, 147, 175, 204, 233,
      /* 162 */      0,   0,   1,   2,   7,  15,  29,  48,
                       70,  94, 120, 147, 175, 203, 233,
      /* 163 */      0,   0,   1,   2,   7,  15,  29,  47,
                       70,  94, 119, 146, 174, 203, 233,
      /* 164 */      0,   0,   1,   2,   6,  15,  28,  47,
                       69,  93, 119, 146, 174, 203, 233,
      /* 165 */      0,   0,   0,   2,   6,  15,  28,  46,
                       68,  93, 118, 145, 173, 203, 233,
      /* 166 */      0,   0,   0,   2,   6,  14,  28,  46,
                       68,  92, 118, 145, 173, 202, 233,
      /* 167 */      0,   0,   0,   2,   6,  14,  27,  45,
                       67,  91, 117, 144, 173, 202, 233,
      /* 168 */      0,   0,   0,   2,   6,  14,  27,  45,
                       67,  91, 117, 144, 172, 202, 233,
      /* 169 */      0,   0,   0,   2,   6,  14,  27,  45,
                       66,  90, 116, 143, 172, 202, 232,
      /* 170 */      0,   0,   0,   2,   6,  13,  26,  44,
                       66,  90, 115, 143, 171, 201, 232,
      /* 171 */      0,   0,   0,   2,   5,  13,  26,  44,
                       65,  89, 115, 142, 171, 201, 232,
      /* 172 */      0,   0,   0,   2,   5,  13,  26,  43,
                       65,  89, 114, 142, 171, 201, 232,
      /* 173 */      0,   0,   0,   2,   5,  13,  25,  43,
                       64,  88, 114, 141, 170, 200, 232,
      /* 174 */      0,   0,   0,   2,   5,  12,  25,  42,
                       64,  88, 113, 141, 170, 200, 232,
      /* 175 */      0,   0,   0,   2,   5,  12,  25,  42,
                       63,  87, 113, 140, 169, 200, 232,
      /* 176 */      0,   0,   0,   1,   5,  12,  24,  41,
                       63,  87, 112, 140, 169, 200, 231,
      /* 177 */      0,   0,   0,   1,   5,  12,  24,  41,
                       62,  86, 112, 139, 169, 199, 231,
      /* 178 */      0,   0,   0,   1,   5,  12,  24,  41,
                       62,  85, 111, 139, 168, 199, 231,
      /* 179 */      0,   0,   0,   1,   5,  11,  23,  40,
                       61,  85, 111, 138, 168, 199, 231,
      /* 180 */      0,   0,   0,   1,   4,  11,  23,  40,
                       61,  84, 110, 138, 167, 198, 231,
      /* 181 */      0,   0,   0,   1,   4,  11,  23,  39,
                       60,  84, 110, 137, 167, 198, 231,
      /* 182 */      0,   0,   0,   1,   4,  11,  22,  39,
                       60,  83, 109, 137, 167, 198, 231,
      /* 183 */      0,   0,   0,   1,   4,  11,  22,  39,
                       59,  83, 109, 137, 166, 198, 231,
      /* 184 */      0,   0,   0,   1,   4,  10,  22,  38,
                       59,  82, 108, 136, 166, 197, 230,
      /* 185 */      0,   0,   0,   1,   4,  10,  21,  38,
                       58,  82, 108, 136, 165, 197, 230,
      /* 186 */      0,   0,   0,   1,   4,  10,  21,  37,
                       58,  81, 107, 135, 165, 197, 230,
      /* 187 */      0,   0,   0,   1,   4,  10,  21,  37,
                       57,  81, 107, 135, 165, 197, 230,
      /* 188 */      0,   0,   0,   1,   4,  10,  21,  37,
                       57,  80, 106, 134, 164, 196, 230,
      /* 189 */      0,   0,   0,   1,   4,  10,  20,  36,
                       57,  80, 106, 134, 164, 196, 230,
      /* 190 */      0,   0,   0,   1,   4,   9,  20,  36,
                       56,  79, 105, 133, 164, 196, 230,
      /* 191 */      0,   0,   0,   1,   3,   9,  20,  35,
                       56,  79, 105, 133, 163, 195, 230,
      /* 192 */      0,   0,   0,   1,   3,   9,  20,  35,
                       55,  78, 104, 132, 163, 195, 229,
      /* 193 */      0,   0,   0,   1,   3,   9,  19,  35,
                       55,  78, 104, 132, 162, 195, 229,
      /* 194 */      0,   0,   0,   1,   3,   9,  19,  34,
                       54,  77, 103, 132, 162, 195, 229,
      /* 195 */      0,   0,   0,   1,   3,   9,  19,  34,
                       54,  77, 103, 131, 162, 194, 229,
      /* 196 */      0,   0,   0,   1,   3,   9,  18,  34,
                       53,  77, 102, 131, 161, 194, 229,
      /* 197 */      0,   0,   0,   1,   3,   8,  18,  33,
                       53,  76, 102, 130, 161, 194, 229,
      /* 198 */      0,   0,   0,   1,   3,   8,  18,  33,
                       53,  76, 101, 130, 161, 194, 229,
      /* 199 */      0,   0,   0,   1,   3,   8,  18,  33,
                       52,  75, 101, 129, 160, 193, 229,
      /* 200 */      0,   0,   0,   1,   3,   8,  18,  32,
                       52,  75, 100, 129, 160, 193, 228,
      /* 201 */      0,   0,   0,   1,   3,   8,  17,  32,
                       51,  74, 100, 128, 159, 193, 228,
      /* 202 */      0,   0,   0,   1,   3,   8,  17,  32,
                       51,  74, 100, 128, 159, 192, 228,
      /* 203 */      0,   0,   0,   1,   3,   8,  17,  31,
                       51,  73,  99, 128, 159, 192, 228,
      /* 204 */      0,   0,   0,   1,   3,   7,  17,  31,
                       50,  73,  99, 127, 158, 192, 228,
      /* 205 */      0,   0,   0,   1,   3,   7,  16,  31,
                       50,  72,  98, 127, 158, 192, 228,
      /* 206 */      0,   0,   0,   1,   2,   7,  16,  30,
                       49,  72,  98, 126, 158, 191, 228,
      /* 207 */      0,   0,   0,   1,   2,   7,  16,  30,
                       49,  72,  97, 126, 157, 191, 228,
      /* 208 */      0,   0,   0,   1,   2,   7,  16,  30,
                       49,  71,  97, 125, 157, 191, 227,
      /* 209 */      0,   0,   0,   1,   2,   7,  16,  29,
                       48,  71,  96, 125, 156, 191, 227,
      /* 210 */      0,   0,   0,   1,   2,   7,  15,  29,
                       48,  70,  96, 125, 156, 190, 227,
      /* 211 */      0,   0,   0,   1,   2,   7,  15,  29,
                       47,  70,  95, 124, 156, 190, 227,
      /* 212 */      0,   0,   0,   1,   2,   6,  15,  29,
                       47,  69,  95, 124, 155, 190, 227,
      /* 213 */      0,   0,   0,   1,   2,   6,  15,  28,
                       47,  69,  95, 123, 155, 190, 227,
      /* 214 */      0,   0,   0,   0,   2,   6,  15,  28,
                       46,  69,  94, 123, 155, 189, 227,
      /* 215 */      0,   0,   0,   0,   2,   6,  14,  28,
                       46,  68,  94, 122, 154, 189, 227,
      /* 216 */      0,   0,   0,   0,   2,   6,  14,  27,
                       46,  68,  93, 122, 154, 189, 226,
      /* 217 */      0,   0,   0,   0,   2,   6,  14,  27,
                       45,  67,  93, 122, 154, 188, 226,
      /* 218 */      0,   0,   0,   0,   2,   6,  14,  27,
                       45,  67,  92, 121, 153, 188, 226,
      /* 219 */      0,   0,   0,   0,   2,   6,  14,  27,
                       45,  66,  92, 121, 153, 188, 226,
      /* 220 */      0,   0,   0,   0,   2,   6,  13,  26,
                       44,  66,  91, 120, 152, 188, 226,
      /* 221 */      0,   0,   0,   0,   2,   6,  13,  26,
                       44,  66,  91, 120, 152, 187, 226,
      /* 222 */      0,   0,   0,   0,   2,   5,  13,  26,
                       43,  65,  91, 120, 152, 187, 226,
      /* 223 */      0,   0,   0,   0,   2,   5,  13,  25,
                       43,  65,  90, 119, 151, 187, 226,
      /* 224 */      0,   0,   0,   0,   2,   5,  13,  25,
                       43,  64,  90, 119, 151, 187, 225,
      /* 225 */      0,   0,   0,   0,   2,   5,  13,  25,
                       42,  64,  89, 118, 151, 186, 225,
      /* 226 */      0,   0,   0,   0,   2,   5,  12,  25,
                       42,  64,  89, 118, 150, 186, 225,
      /* 227 */      0,   0,   0,   0,   2,   5,  12,  24,
                       42,  63,  89, 118, 150, 186, 225,
      /* 228 */      0,   0,   0,   0,   2,   5,  12,  24,
                       41,  63,  88, 117, 150, 186, 225,
      /* 229 */      0,   0,   0,   0,   1,   5,  12,  24,
                       41,  62,  88, 117, 149, 185, 225,
      /* 230 */      0,   0,   0,   0,   1,   5,  12,  24,
                       41,  62,  87, 116, 149, 185, 225,
      /* 231 */      0,   0,   0,   0,   1,   5,  12,  23,
                       40,  62,  87, 116, 149, 185, 225,
      /* 232 */      0,   0,   0,   0,   1,   5,  11,  23,
                       40,  61,  87, 116, 148, 185, 224,
      /* 233 */      0,   0,   0,   0,   1,   4,  11,  23,
                       40,  61,  86, 115, 148, 184, 224,
      /* 234 */      0,   0,   0,   0,   1,   4,  11,  23,
                       40,  61,  86, 115, 148, 184, 224,
      /* 235 */      0,   0,   0,   0,   1,   4,  11,  23,
                       39,  60,  85, 114, 147, 184, 224,
      /* 236 */      0,   0,   0,   0,   1,   4,  11,  22,
                       39,  60,  85, 114, 147, 184, 224,
      /* 237 */      0,   0,   0,   0,   1,   4,  11,  22,
                       39,  59,  85, 114, 147, 183, 224,
      /* 238 */      0,   0,   0,   0,   1,   4,  11,  22,
                       38,  59,  84, 113, 146, 183, 224,
      /* 239 */      0,   0,   0,   0,   1,   4,  10,  22,
                       38,  59,  84, 113, 146, 183, 224,
      /* 240 */      0,   0,   0,   0,   1,   4,  10,  21,
                       38,  58,  83, 112, 145, 183, 223,
      /* 241 */      0,   0,   0,   0,   1,   4,  10,  21,
                       37,  58,  83, 112, 145, 182, 223,
      /* 242 */      0,   0,   0,   0,   1,   4,  10,  21,
                       37,  58,  83, 112, 145, 182, 223,
      /* 243 */      0,   0,   0,   0,   1,   4,  10,  21,
                       37,  57,  82, 111, 144, 182, 223,
      /* 244 */      0,   0,   0,   0,   1,   4,  10,  21,
                       36,  57,  82, 111, 144, 182, 223,
      /* 245 */      0,   0,   0,   0,   1,   4,  10,  20,
                       36,  57,  81, 111, 144, 181, 223,
      /* 246 */      0,   0,   0,   0,   1,   4,   9,  20,
                       36,  56,  81, 110, 143, 181, 223,
      /* 247 */      0,   0,   0,   0,   1,   4,   9,  20,
                       36,  56,  81, 110, 143, 181, 223,
      /* 248 */      0,   0,   0,   0,   1,   3,   9,  20,
                       35,  56,  80, 109, 143, 181, 223,
      /* 249 */      0,   0,   0,   0,   1,   3,   9,  19,
                       35,  55,  80, 109, 142, 180, 222,
      /* 250 */      0,   0,   0,   0,   1,   3,   9,  19,
                       35,  55,  80, 109, 142, 180, 222,
      /* 251 */      0,   0,   0,   0,   1,   3,   9,  19,
                       34,  55,  79, 108, 142, 180, 222,
      /* 252 */      0,   0,   0,   0,   1,   3,   9,  19,
                       34,  54,  79, 108, 141, 180, 222,
      /* 253 */      0,   0,   0,   0,   1,   3,   9,  19,
                       34,  54,  78, 108, 141, 179, 222,
      /* 254 */      0,   0,   0,   0,   1,   3,   9,  19,
                       34,  54,  78, 107, 141, 179, 222,
      /* 255 */      0,   0,   0,   0,   1,   3,   8,  18,
                       33,  53,  78, 107, 140, 179, 222};

/*--------HRinterpolate------------------------------------------------------*/

/* Given an interpolation value, an exponent (index into lookup table), a  */
/*   sub-table number, and the low index for the range within which we're  */
/*   to interpolate, this function returns an interpolated value from the  */
/*   static arrays defined above.                                          */

#if defined(__STDC__) || defined(__cplusplus)
	static int HRinterpolate( int i_val,
				  int expon,
				  int tbl_num,
				  int indx )
#else
	static int HRinterpolate (i_val, expon, tbl_num, indx)
	int i_val,  /* interpolation value */
	    expon,  /* exponent (index into lookup table) */
	    tbl_num,  /* sub-table number */
	    indx;  /* low index between which we'll interpolate */
#endif

  {
    register int lkval, lkval2;  /* lookup value (temporary storage) */
    register int interp;  /* interpolation ratio */

    lkval = lookup[tbl_num][indx];
    lkval2 = i_val - lkval;
    interp = (lkval2 << 7) / (lookup[tbl_num][indx + 1] - lkval);

    lkval = table[expon][indx];
    lkval2 = table[expon][indx + 1] - lkval;
    return((interp * lkval2) + (lkval << 7));
  }  /* HRinterpolate */

/*--------HRpower------------------------------------------------------------*/

/* Returns (value ^ power) as a <1:15> fixed point integer value in the    */
/*   range [0..32768], given a <1:15> fixed point integer value and an     */
/*   integer exponent in the range [1..255].                               */

#if defined(__STDC__) || defined(__cplusplus)
	int HRpower( int value,
		     int expon )
#else
	int HRpower (value, expon)
	int value, expon;
#endif

  {
    register int tbl_num,  /* sub-table number */
                 lkup, lkup2;  /* lookup values (temporary storage) */
    register int intrp;  /* interpolation ratio */

    if (value > 32767)
       return( 32768 );
       
    if (expon < 2)  /* value ^ 1 = value */
      return(value);
    tbl_num = 0;
    while (expon > threshold[tbl_num][0])
      tbl_num++;
    if (value < threshold[tbl_num][1])  /* (small value) ^ expon = 0 */
      return(0);
    
    /* Binary search: 7 -> 3, 11 -> 1, 5, 9, 13 -> 0, 2, 4, 6, 8, 10, 12, 14 */
    if (value == lookup[tbl_num][7])
      return(lkup=table[expon][7],((lkup << 7) + (lkup >> 1)));
    else if (value < lookup[tbl_num][7])
      {
        if (value == lookup[tbl_num][3])
          return(lkup=table[expon][3],((lkup << 7) + (lkup >> 1)));
        else if (value < lookup[tbl_num][3])
          {
            if (value == lookup[tbl_num][1])
              return(lkup=table[expon][1],((lkup << 7) + (lkup >> 1)));
            else if (value < lookup[tbl_num][1])
              {
                if (value == lookup[tbl_num][0])
                  return(lkup=table[expon][0],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][0])
                  {  /* interpolate between 0 and smallest value (index 0) */
                    intrp = (value << 7) / lookup[tbl_num][0];
                    return(lkup=table[expon][0],(intrp * lkup));
                  }
                else  /* interpolate between index 0 and index 1 */
                  return(HRinterpolate(value, expon, tbl_num, 0));
              }
            else
              {
                if (value == lookup[tbl_num][2])
                  return(lkup=table[expon][2],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][2])  /* index 1 to index 2 */
                  return(HRinterpolate(value, expon, tbl_num, 1));
                else  /* index 2 to index 3 */
                  return(HRinterpolate(value, expon, tbl_num, 2));
              }
          }
        else
          {
            if (value == lookup[tbl_num][5])
              return(lkup=table[expon][5],((lkup << 7) + (lkup >> 1)));
            else if (value < lookup[tbl_num][5])
              {
                if (value == lookup[tbl_num][4])
                  return(lkup=table[expon][4],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][4])  /* index 3 to index 4 */
                  return(HRinterpolate(value, expon, tbl_num, 3));
                else  /* index 4 to index 5 */
                  return(HRinterpolate(value, expon, tbl_num, 4));
              }
            else
              {
                if (value == lookup[tbl_num][6])
                  return(lkup=table[expon][6],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][6])  /* index 5 to index 6 */
                  return(HRinterpolate(value, expon, tbl_num, 5));
                else  /* index 6 to index 7 */
                  return(HRinterpolate(value, expon, tbl_num, 6));
              }
          }
      }
    else
      {
        if (value == lookup[tbl_num][11])
          return(lkup=table[expon][11],((lkup << 7) + (lkup >> 1)));
        else if (value < lookup[tbl_num][11])
          {
            if (value == lookup[tbl_num][9])
              return(lkup=table[expon][9],((lkup << 7) + (lkup >> 1)));
            else if (value < lookup[tbl_num][9])
              {
                if (value == lookup[tbl_num][8])
                  return(lkup=table[expon][8],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][8])  /* index 7 to index 8 */
                  return(HRinterpolate(value, expon, tbl_num, 7));
                else  /* index 8 to index 9 */
                  return(HRinterpolate(value, expon, tbl_num, 8));
              }
            else
              {
                if (value == lookup[tbl_num][10])
                  return(lkup=table[expon][10],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][10])  /* index 9 to index 10 */
                  return(HRinterpolate(value, expon, tbl_num, 9));
                else  /* index 10 to index 11 */
                  return(HRinterpolate(value, expon, tbl_num, 10));
              }
          }
        else
          {
            if (value == lookup[tbl_num][13])
              return(lkup=table[expon][13],((lkup << 7) + (lkup >> 1)));
            else if (value < lookup[tbl_num][13])
              {
                if (value == lookup[tbl_num][12])
                  return(lkup=table[expon][12],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][12])  /* index 11 - index 12 */
                  return(HRinterpolate(value, expon, tbl_num, 11));
                else  /* index 12 to index 13 */
                  return(HRinterpolate(value, expon, tbl_num, 12));
              }
            else
              {
                if (value == lookup[tbl_num][14])
                  return(lkup=table[expon][14],((lkup << 7) + (lkup >> 1)));
                else if (value < lookup[tbl_num][14])  /* index 13 - index 14 */
                  return(HRinterpolate(value, expon, tbl_num, 13));
                else  /* interpolate between largest value (index 14) and 1 */
                  {
                    lkup = lookup[tbl_num][14];
                    lkup2 = value - lkup;
                    intrp = (lkup2 << 7) / (32767 - lkup);

                    lkup = table[expon][14];
                    lkup2 = 255 - lkup;
                    return((intrp * lkup2) + (lkup<<7));
                  }
              }
          }
      }
  }  /* HRpower */
