#
#	I/STRUCT
#	Checks that global shell variables are exported.
#
varList='${EXNUC} ${GRNUC} ${MODEL} ${STRUCT} ${VDS}'

#
# Check that global shell variables exist.
#
RC=0
for var in ${varList} ; do
	if [ -z "`eval echo ${var}`" ] ; then
		echo "Shell variable ${var} not set"
		RC=1
	fi
done

if [ -z "${BS}" ] ; then
	if [ -z "${BSPMATH}" ] ; then
		echo "Shell variable \${BS} or \${BSPMATH} not set"
		RC=1
	else
		export BS=${BSPMATH}
	fi
elif [ -z "${BSPMATH}" ] ; then
	export BSPMATH=${BS}
elif [ "${BS}" != "${BSPMATH}" ] ; then
	echo "\${BS} and \${BSPMATH} have different values:"
	echo "BS	= ${BS}"
	echo "BSPMATH = ${BSPMATH}\n"
	RC=1
fi

if [ ${RC} != 0 ] ; then exit ${RC} ; fi

#
# Check that directories exist
#
dirList="`eval echo ${varList}` ${BS}"
for d in ${dirList} ; do
	if [ ! -d "${d}" ] ; then
		echo "Directory ${d} not found"
		RC=1
	fi
done

#
# Set I/STRUCT directories global variables.
#
export VSconfig=${STRUCT}/config
export VScommands=${VSconfig}/commands
export VSmessages=${VSconfig}/english/messages
export VSmsgsrc=${VSmessages}/src
dirList="${VSconfig} ${VScommands} ${VSmessages} ${VSmsgsrc}"
for d in ${dirList} ; do
	if [ ! -d "${d}" ] ; then
		echo "Directory ${d} not found"
		RC=1
	fi
done

#
# Set I/STRUCT files global variables.
#
VSmsgpattern=VScmd
export VSmsgoutput=${VSmessages}/${VSmsgpattern}.msg
export VSmsgheader=${STRUCT}/include/${VSmsgpattern}.h
export VSmsgsource=${VSmsgsrc}/${VSmsgpattern}.mb
export VScmdtbl=${VSconfig}/vs.cmd
dirList="${VSmsgoutput} ${VSmsgheader} ${VSmsgsource} ${VScmdtbl}"
for d in ${dirList} ; do
	if [ ! -f "${d}" ] ; then
		echo "File ${d} not found"
		RC=1
	fi
done

varList='${COMPILER} ${COMPOPT} ${MKDOPT}'

#
# Check that global shell variables exist for compilation.
#
RC=0
for var in ${varList} ; do
	if [ -z "`eval echo ${var}`" ] ; then
		echo "Shell variable ${var} not set: compilation impossible"
		RC=1
	fi
done

#
# Do not use exit here !
#
return ${RC}
