#
# COPYRIGHT
#                   COPYRIGHT INTERGRAPH CORPORATION
#                   < 1986, 1987, 1988, 1989, 1990 >
#
#            Including software  and  its  file formats, and
#            audio-visual displays; all rights reserved; may
#            only  be  used   pursuant   to  the  applicable
#            software     license     agreement;    contains
#            confidential  and  proprietary  information  of
#            intergraph and/or other  third parties which is
#            protected  by  copyright,   trade  secret,  and
#            trademark  law,  and  may  not  be  provided or
#            otherwise made available  without prior written
#            authorization.
#
#
#                       RESTRICTED RIGHTS LEGEND
#            Use, duplication,  or  disclosure  by  the U.S.
#            Government is  subject  to  restrictions as set
#            forth in subdivision  (b)(3)(ii)  of the Rights
#            in Technical Data  and Computer Software clause
#             at 52.227-7013.
# 
# 
#             Intergraph Corporation
#             One Madison Industrial Park
#             Huntsville, Al 35807-4201
# 
#


pd=/usr/ip32/product_data

if [ ! -r $pd ]
then
    if [ -f $pd ]
    then
        echo $0: $pd not readable. 1>&2
        exit 1
    else
        echo $0: $pd not found. 1>&2
        exit 2
    fi
fi

if [ ! -x /usr/bin/awk ]
then
    echo $0: /usr/bin/awk not found. 1>&2
    exit 3
fi


  if [ -z "$EXNUC" -o ! -d "$EXNUC" ]  ### if EXNUC isn't already defined, then look in
  then		        ### the product_data file and see where EXNUC is
    EXNUC=`/usr/bin/awk '/ I\/EXNUC / {print $5}' $pd`
    export EXNUC
  fi

  if [ -z "$GRNUC" -o ! -d "$GRNUC" ]  ### if GRNUC isn't already defined, then look in
  then		    ### the product_data file and see where GRNUC is
    Draft=`/usr/bin/awk '/ I\/GRNUC / {print $5}' $pd`

    if [ -n "$Draft" -a -d "$Draft" ]
    then
      GRNUC=$Draft
      export GRNUC
    fi
  fi


# echo "EXNUC = $EXNUC"

if [ -z "$EXNUC" -o ! -d "$EXNUC" ]
then
  echo "\n$0:  Can't find EXNUC development platform --" 1>&2
  if [ "$EXNUC" ]
  then
    echo "\t \"$EXNUC\" is not a valid directory.\n" 1>&2
  fi
  exit 1
fi

# echo "GRNUC = $GRNUC"

if [ ! "$COBCPPOPT" ]
then	 ### COBCPPOPT is needed so Slic can cpp the .sl file
  COBCPPOPT="-I$EXNUC/include"
  export COBCPPOPT

  if [ -n "$GRNUC" -a -d "$GRNUC" ]
  then
    COBCPPOPT="$COBCPPOPT -I$GRNUC/include"
  fi
fi

#######  Unset the shell var TMPDIR, so subsequent calls by Slic
#######  to tmpname() will work
if [ "$TMPDIR" ]
then
  # echo "Before unset: TMPDIR=$TMPDIR"
  unset TMPDIR	1>/dev/null 2>&1
  # echo "After unset:  TMPDIR=$TMPDIR"
fi

##############  actually run Slic #####################
  $EXTARG/bin/Slic $*

