/* $Id $  */

/*************************************************************************
 * I/LOFT
 *
 * File:        src/vdppl/COz_delref.u
 *
 * Description: Delete Reference File.
 *
 * Dependencies:
 *
 * Revision History:
 *      $Log $
 *
 * History:
 *      MM/DD/YY   AUTHOR       DESCRIPTION
 *      09/25/00   Rama Rao     File Creation
 *************************************************************************/

#include "VDppl.h"
#include "refmacros.h"

extern 	VD_bulkDeleteByGRids(), GRrevreffiles();

main()
{
long		msg;
struct GRid	*ref_ids;
int		num_ref,i;
IGRchar		exp_txt[300], full_name[DI_PATH_MAX], file_name[DI_PATH_MAX];
struct GRmd_env	loc_env;

  message( "Delete Reference File" );

  ci$get( string = exp_txt,
	  prompt = "Enter Reference File Name" );

  ci$get_module_info( md_env = &loc_env);

  gr$review_ref_files( msg = &msg,
	               ref_osnum = &loc_env.md_id.osnum,
                       ref_grids = &ref_ids,
                       num_found = &num_ref);

  for(i=0; i < num_ref; i = i +1)
  {
      di$untranslate( objname = full_name,
                      objid   = ref_ids[i].objid,
                      osnum   = ref_ids[i].osnum );

      di$split( pathname = full_name,
                name     = file_name );

      if( !strcmp( file_name, exp_txt ) )
      {
	 VD_bulkDeleteByGRids( &loc_env, 1, &ref_ids[i] );
      }
  }

  if( ref_ids ) 	free( ref_ids );

  return 1;
}
