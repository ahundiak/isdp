echo "cd $PDU/design/cob"
cd $PDU/design/cob
echo
echo "Run slicbuild"
./slicbuild
echo

#This removes all .o files in the PDU directories
#echo "Removing the .o files in the PDU directories"
#echo ""
if [ "$REMOVEOBJ" = "y" ]
then
echo "Run $PDU/ldpdu/rmPDUobjfiles"
$PDU/ldpdu/./rmPDUobjfiles
fi

echo "cd $PDU/kernal"
echo
cd $PDU/kernal
rm makefile
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno kernal.m
else
echo "PDU - MAKEMAKE on CLIPPER for KERNAL (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno kernal.m
fi
else
echo "PDU -MAKEMAKE on CLIPPER for KERNAL (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno kernal.m
fi

if [ ! -f $PDU/kernal/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/kernal directory
   echo
   exit 1
fi
echo "Run make in $PDU/kernal"
echo
grmake

echo "cd $PDU/design"
echo
cd ../design
rm makefile
rm PDUdesign.s
#rm $PDU/lib/PDUdesign.a
echo ""
if [ "$REACTIVE" != "y" ]
then 
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno design.m
else
#grmakemake is used due to constraints from GRNUC
echo "PDU - GRMAKEMAKE on CLIPPER for DESIGN (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno design.m
fi
else
echo "PDU - GRMAKEMAKE on CLIPPER for DESIGN (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno design.m
fi

if [ ! -f $PDU/design/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/design directory
   echo
   exit 1
fi
echo "Run $GRNUC/bin/grmake in $PDU/design"
echo
#grmake is used due to constraints from GRNUC
$GRNUC/bin/grmake

echo "cd $PDU/catalogs"
echo
cd ../catalogs
rm makefile
rm PDUcatalogs.s
#rm $PDU/lib/PDUcatalogs.a
echo ""
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno catalogs.m
else
echo "PDU - MAKEMAKE on CLIPPER for CATALOGS (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno catalogs.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for CATALOGS (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno catalogs.m
fi
if [ ! -f $PDU/catalogs/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/catalogs directory
   echo
   exit 1
fi
echo "Run make in $PDU/catalogs"
echo
grmake

echo "cd $PDU/parts"
echo
cd ../parts
rm makefile
rm PDUparts.s
#rm $PDU/lib/PDUparts.a
echo ""
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno parts.m
else
echo "PDU - MAKEMAKE on CLIPPER for PARTS (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno parts.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for PARTS (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno parts.m
fi

if [ ! -f $PDU/parts/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/parts directory
   echo
   exit 1
fi
echo "Run make in $PDU/parts"
echo
grmake

echo "cd $PDU/assembly"
echo
cd ../assembly
rm makefile
rm PDUassembly.s
#rm $PDU/lib/PDUassembly.a
echo ""
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno assembly.m
else
echo "PDU - MAKEMAKE on CLIPPER for ASSEMBLY (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno assembly.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for ASSEMBLY (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno assembly.m
fi

if [ ! -f $PDU/assembly/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/assembly directory
   echo
   exit 1
fi
echo "Run make in $PDU/assembly"
echo
grmake

echo "cd $PDU/init"
echo
cd ../init
rm makefile
#rm $PDU/lib/PDUinit.a
echo ""
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno init.m
else
echo "PDU - MAKEMAKE on CLIPPER for INIT (Reactive loading is not applicable)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno init.m
fi

if [ ! -f $PDU/init/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/init directory
   echo
   exit 1
fi
echo "Run make in $PDU/init"
echo
grmake

echo "cd $PDU/filemgr"
echo
cd ../filemgr
rm makefile
rm PDUfilemgr.s
#rm $PDU/lib/PDUfilemgr.a
echo ""
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno filemgr.m
else
echo "PDU - MAKEMAKE on CLIPPER for FILEMGR (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno filemgr.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for FILEMGR (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno filemgr.m
fi

if [ ! -f $PDU/filemgr/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/filemgr directory
   echo
   exit 1
fi
echo "Run make in $PDU/filemgr"
echo
grmake

echo "cd $PDU/pdmr"
echo
cd ../pdmr
rm makefile
rm PDUpdmr.s
#rm $PDU/lib/pdmr.a
echo ""
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno pdmr.m
else
echo "PDU - MAKEMAKE on CLIPPER for PDMR (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno pdmr.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for PDMR (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno pdmr.m
fi

if [ ! -f $PDU/pdmr/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/pdmr directory
   echo
   exit 1
fi
echo "Run make in $PDU/pdmr"
echo
grmake

echo "cd $PDU/reports"
echo
cd ../reports
rm makefile
rm PDUreports.s
rm PDUpsurpt.s
#rm $PDU/lib/PDUreports.a
echo ""
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno reports.m
else
echo "PDU - MAKEMAKE on CLIPPER for REPORTS (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno reports.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for REPORTS (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno reports.m
fi

if [ ! -f $PDU/reports/makefile ]
then
   echo WARNING...WARNING

   echo
   echo There is not a makefile in the $PDU/reports directory
   echo
   exit 1
fi
echo "Run make in $PDU/reports"
echo
grmake
if [ "$REACTIVE" != "y" ]
then
echo "Run make -f make_psurpt in $PDU/reports"
echo
grmake -f make_psurpt
else
echo "Run make -f make_psurpt PDUpsurpt.s in $PDU/reports"
echo
grmake -f make_psurpt PDUpsurpt.s
fi

echo "cd $PDU/tools"
echo
cd ../tools
rm makefile
rm PDUtools.s
#rm $PDU/lib/PDUtools.a
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno tools.m
else
echo "PDU - MAKEMAKE on CLIPPER for TOOLS (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno tools.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for TOOLS (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno tools.m
fi

if [ ! -f $PDU/tools/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/tools directory
   echo
   exit 1
fi
echo "Run make in $PDU/tools"
echo
grmake

echo "cd $PDU/misc"
echo
cd ../misc
rm makefile
rm PDUmisc.s
#rm $PDU/lib/PDUmisc.a
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno misc.m
else
echo "PDU - MAKEMAKE on CLIPPER for MISC (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno misc.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for MISC (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno misc.m
fi

if [ ! -f $PDU/misc/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/misc directory
   echo
   exit 1
fi
echo "Run make in $PDU/misc"
echo
grmake

echo "cd $PDU/macros"
echo
cd ../macros
rm makefile
rm PDUmacros.s
#rm $PDU/lib/PDUmacros.a
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno macros.m
else
echo "PDU - MAKEMAKE on CLIPPER for MACROS (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno macros.m
fi
else
echo "PDU - MAKEMAKE on CLIPPER for MACROS (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno macros.m
fi

if [ ! -f $PDU/macros/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/macros directory
   echo
   exit 1
fi
echo "Run make in $PDU/macros"
echo
grmake

echo "cd $PDU/pal/src/funk"
echo
cd ../pal/src/funk
rm makefile
rm PDUfunk.s
#rm $PDU/lib/PDUfunk.a
if [ "$REACTIVE" != "y" ]
then
if [ "$TARG" = "sparc" ]
then
$GRNUC/bin/grmakemake -i $PDU/include/sun_igno funk.m
#elif [ "$PLATFORM" = "21" ]
#then
#$GRNUC/bin/grmakemake -Dbld21x -i $PDU/include/clip_igno funk.m
else
#grmakemake is used due to constraints from GRNUC
echo "PDU - GRMAKEMAKE on CLIPPER for PAL/SRC/FUNK (non-reactive)"
$GRNUC/bin/grmakemake -i $PDU/include/clip_igno funk.m
fi
else
#grmakemake is used due to constraints from GRNUC
echo "PDU - GRMAKEMAKE on CLIPPER for PAL/SRC/FUNK (reactive)"
$GRNUC/bin/grmakemake -Dreactive -i $PDU/include/clip_igno funk.m
fi

if [ ! -f $PDU/pal/src/funk/makefile ]
then
   echo WARNING...WARNING
   echo
   echo There is not a makefile in the $PDU/pal/src/funk directory
   echo
   exit 1
fi
echo "Run make in $PDU/pal/src/funk"
#grmakemake is used due to constraints from GRNUC
echo
$GRNUC/bin/grmake

echo "cd $PDU/pal/src/ris"
echo
cd ../ris
rm PDUris.s
#if [ "$TARG" = "c100" ]
#then
#make
#fi
#if [ "$TARG" = "c400" ]
#then
#make -f mkfile_c4
#fi
if [ "$REACTIVE" != "y" ]
then
echo "Run make in $PDU/pal/src/ris"
echo
grmake
else
grmake 
grmake PDUris.s
fi

echo "cd $PDU/pal/src/pdmr"
echo
cd ../pdmr
rm PDUpalpdmr.s
#if [ "$TARG" = "c100" ]
#then
#make
#fi
#if [ "$TARG" = "c400" ]
#then
#make -f mkfile_c4
#fi
if [ "$REACTIVE" != "y" ]
then
echo "Run make in $PDU/pal/src/pdmr"
echo
grmake
else
#PDUpalpdmr.s is a target in the makefile
echo "Run make PDUpalpdmr.s in $PDU/pal/src/pdmr"
echo
grmake PDUpalpdmr.s
fi

echo "cd $PDU/pal/src/pdmr/svs"
echo
cd svs
rm PDUsvs.s
if [ "$REACTIVE" != "y" ]
then
echo "Run make in $PDU/pal/src/pdmr/svs"
echo
grmake
else
#PDUsvs.s is a target in the makefile
echo "Run make PDUsvs.s in $PDU/pal/src/pdmr/svs"
echo
grmake 
grmake PDUsvs.s
fi

cd ..

echo "cd $PDU/pal/src/ppl"
echo
cd ../ppl

echo "Copying $PDU/pal/src/ppl/*.u to $PDU/ppl/src"
echo
cp *.u ../../../ppl/src

echo "cd $PDU/ppl/src"
echo
cd ../../../ppl/src

echo "Run cci.sh on $PDU/ppl/src/*.u's"
echo
./cci.sh *.u

echo "cd $PDU/ldpdu"
echo
cd ../../ldpdu
if [ "$TARG" = "sparc" ]
then
echo "Calling ld.sun"
echo ""
./ld.sun
elif [ "$REACTIVE" != "y" ]
then
echo "Calling ld.sh"
echo ""
./ld.sh
else
#echo "Removing *.o files from $PDU/config/dload/init for reactive loading."
#echo
#rm $PDU/config/dload/init/*.o
echo "Calling ldstub.sh"
echo
./ldstub.sh
fi

if [ "$COW" = "y" ] || [ "$DELTA" = "y" ]
then
echo "cd $PDU"
echo
cd ..
#if [ "$PLATFORM" = "21" ]
#then
#find . -exec chown pdu21src {} \;
#find . -exec chgrp users {} \;
#else
echo "changing owner to $PDULOGNAME and group to users"
echo
find . -exec chown $PDULOGNAME {} \;
find . -exec chgrp users {} \;
#fi
fi
