#This script collect design documentation from the directory $PDU/designdoc
#and initialize the DESIGNDOC product for newprod.

passwd=`grep root /etc/passwd | awk -F: '{print $2}'`
if [ "$passwd" ]
then
  my_id=`ps -l -p $$ | awk '{print $3}'`
  my_id=`echo $my_id | awk '{print $2}'`
  if [ "$my_id" -ne 0 ]
  then
    echo "Must be super-user to execute!"
    exit 0
  fi
fi

ICOM=/usr/icom
login=pdu24src.u4src
NODE=`uname -n`

echo
echo "Have you updated the README and product.def in designdoc (y/n) [y] \c"
read UPDATE
echo
if [ "$UPDATE" = "n" ]
then
echo
echo "Exiting from build procedure."
echo
exit 0
else
echo "Do you wish to retieve source prior to a particular date (y/n)? [n] \c"
read DELTA
if [ "$DELTA" = "y" ]
then
echo "Please give the date: (mmddyy) \c"
read SINCE
echo "Removing $PDU/pdu24.*"
echo ""
cd $PDU
rm pdu24.*
echo ""
fmu pdmdel.root.pdelrt com /usr/icom/delta_pdu.sh $SINCE pdu24 $ICOM/temp $NODE.$login
echo "Uncompress the pdu24* cpio file"
echo ""
cat pdu24* | compress -d | cpio -ivmud
echo
echo "Finished pulling source"
echo
fi

echo "Collecting documentation"
echo
. $PDU/delivery/./collect_doc
echo
echo "Initializing the DESIGNDOC product"
echo
fmu pdmdel.root.pdelrt com /usr/icom/./initialize_doc
fi
