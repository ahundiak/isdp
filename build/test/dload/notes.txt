15 nov 2010

Need to undersatnd the whole dynamic loading process

PDUimage.so is a big problem since i don't have source for it.  When dynamically linking in to a clean executable
get plenty of unresilved symbols.

Bspmath is self contained.  No issues there.

xc is self contained.  Statically linked it in.

Created a bspmath routine to overide a functon in bspmath.so.  Statically linked it in.  Went cleanly and the override was called.

So that is very good.  Don't have to worry about conflicts with .so routines.  And the static linked routines take precedence.

========================
Problem with Vds is that many grnuc routines are overridden.  Making a single executable will be painful at best.  Need to break out
all overridden grnuc routines into their own master library.  Very error prone

Could instead create a model .so file with model/grnuc/exnuc.  Should be possible to link it and not have the dup symbol issues.

First attempt to make a model.so failed with complaints about ret-val in grnuc
This was a referenct to _cc_init which is defined in assembly under grnuc/src/pplsrc/src
Pulled it out for now, need to statically link I guess

==========================
So Vds starts up but coredumping on

status = NFMs_dest_recv_clix(data [FTO_NODENAME],

Called from $VDS/emsfixes/nfm/NFMfile_tr.c
_NFMfs_recv_files (buffer_ptr)

Manually installed the pdu_fixes version of PDU under /opt/ingr/pdu
Seems to dynamically load just fine
Still link to PDUimage to make a Vds executable
Still not sure if we can see files under model.so - Yes, files in model.so can be seen

Seem to have two versions of PDUimage
PDU - 3.3.1.7 21 Jan 1998 synced with EMS 3.3.0
  PDUimage.so 8005892 20 Jan 1998 along with 47 patches, mostly 1998

PDU_FIXES  3.3.2.1 07 Sep 1999
  README mentions PDU/NFM y2k 3.3.2.0

Pdu01 README 3.3.2.0 07 Sep 1999
  PDUimage.so 7829172 Feb 27 1996!!!
  I/PDU     02.01.01.04 03-May-93
  Plus 7 patches also dated from 1996/1997???
  Forms and messages also date from 1996
  The README file mentions new NFMdaemon as well

NFM bin files are dated 07 Sep 1999, consistent with y2k stuff

On dev04, Pdu is linked to /opt/ingr/pdu
  README 3.3.1.7 21 Jan 1998
  PDUimage from 1998

Under pdudp have
  PDUimage 7829172 15 Jan 1998, same size as pdu_fixes
  17 patches dated 1997

pdu_fixes is the same as on willow

Can I load an image and read the actual date?

Under source, find NFM*
vds/emsfixes/nfm only directory

PDU*
  vds/vdsir/src/cm
  vds/emsfixes/pdu
  vds/emsfixes/pdu1
  aim stuff

PDM*
  vds/checking/ppl/PDMcheckin.u
./vds/vdsir/config/english/forms/PDMGetFile
./vds/emsfixes/pdm/PDMcipart.c
./vds/emsfixes/pdu1/PDMcp_files.c
./vds/emsfixes/pdu1/PDMCheckOut.c

Both of the PDUimage.so files have 02.01.01.04 03-May-93 so that is of no value
Pdu_class_definitions
OM_p_FUNCPTR 